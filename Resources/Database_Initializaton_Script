CREATE DATABASE IF NOT EXISTS foxlift;

USE foxlift;

DROP USER IF EXISTS 'foxliftapp'@'localhost';
CREATE USER 'foxliftapp'@'localhost' IDENTIFIED BY 'securepw';
GRANT INSERT, UPDATE, DELETE ON foxlift.* TO 'foxliftapp'@'localhost';

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `users` (
  `fName` varchar(255) DEFAULT NULL,
  `lName` varchar(255) DEFAULT NULL,
  `accountName` varchar(255) DEFAULT NULL,
  `isDriver` tinyint(1) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `uID` int NOT NULL,
  PRIMARY KEY (`uID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `trips`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `trips` (
  `tID` int NOT NULL,
  `type` enum('Ride Share','Taxi') DEFAULT NULL,
  `destination` varchar(255) DEFAULT NULL,
  `startLocation` varchar(255) DEFAULT NULL,
  `time` timestamp NULL DEFAULT NULL,
  `isCompleted` tinyint(1) DEFAULT NULL,
  `isCancelled` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`tID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `message`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `message` (
  `receiverID` int NOT NULL,
  `senderID` int NOT NULL,
  `message` varchar(255) DEFAULT NULL,
  `messageDate` date DEFAULT NULL,
  PRIMARY KEY (`receiverID`,`senderID`),
  KEY `senderID` (`senderID`),
  CONSTRAINT `message_ibfk_1` FOREIGN KEY (`receiverID`) REFERENCES `users` (`uID`),
  CONSTRAINT `message_ibfk_2` FOREIGN KEY (`senderID`) REFERENCES `users` (`uID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `take`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `take` (
  `uID` int NOT NULL,
  `tID` int NOT NULL,
  `SeatsAvailable` int DEFAULT NULL,
  `UserRole` enum('Driver','Passenger','Shared Taxi') DEFAULT NULL,
  PRIMARY KEY (`uID`,`tID`),
  KEY `tID` (`tID`),
  CONSTRAINT `take_ibfk_1` FOREIGN KEY (`uID`) REFERENCES `users` (`uID`),
  CONSTRAINT `take_ibfk_2` FOREIGN KEY (`tID`) REFERENCES `trips` (`tID`),
  CONSTRAINT `take_ibfk_3` FOREIGN KEY (`tID`) REFERENCES `trips` (`tID`),
  CONSTRAINT `take_ibfk_4` FOREIGN KEY (`tID`) REFERENCES `trips` (`tID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `rate`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `rate` (
  `raterID` int NOT NULL,
  `ratedID` int NOT NULL,
  `rating` int DEFAULT NULL,
  PRIMARY KEY (`raterID`,`ratedID`),
  KEY `ratedID` (`ratedID`),
  CONSTRAINT `rate_ibfk_1` FOREIGN KEY (`raterID`) REFERENCES `users` (`uID`),
  CONSTRAINT `rate_ibfk_2` FOREIGN KEY (`ratedID`) REFERENCES `users` (`uID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

DROP TABLE IF EXISTS `report`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `report` (
  `reporterID` int NOT NULL,
  `reportedID` int NOT NULL,
  `report` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`reporterID`,`reportedID`),
  KEY `reportedID` (`reportedID`),
  CONSTRAINT `report_ibfk_1` FOREIGN KEY (`reporterID`) REFERENCES `users` (`uID`),
  CONSTRAINT `report_ibfk_2` FOREIGN KEY (`reportedID`) REFERENCES `users` (`uID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
